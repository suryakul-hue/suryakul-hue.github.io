<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>shop ysurtod</title>
  <meta name="description" content="Toko digital untuk menjual file proyek, preset, desain, dan produk digital lainnya." />
  <meta name="color-scheme" content="light dark" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b0f19; --panel:#0f172a; --text:#e5e7eb; --muted:#94a3b8; --line:#1f2937;
      --brand:#38bdf8; --brand-2:#22d3ee; --radius:16px; --shadow:0 10px 30px rgba(2,6,23,.35);
      --overlay: rgba(2, 6, 23, 0.6);
    }
    :root.light{ --bg:#f8fafc; --panel:#ffffff; --text:#0f172a; --muted:#475569; --line:#e5e7eb; --brand:#0284c7; --brand-2:#06b6d4; --shadow:0 10px 30px rgba(2,6,23,.08); --overlay: rgba(15, 23, 42, 0.35); }
    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{margin:0; font-family:Inter,system-ui,Segoe UI; background:var(--bg); color:var(--text)}
    a{color:inherit; text-decoration:none}
    img{max-width:100%; display:block}
    .container{max-width:1120px; margin:0 auto; padding:0 18px}

    /* Header */
    header{position:sticky; top:0; z-index:50; backdrop-filter:saturate(1.2) blur(10px); background:linear-gradient(180deg,rgba(2,6,23,.85),rgba(2,6,23,.5)); border-bottom:1px solid rgba(148,163,184,.14)}
    :root.light header{background:linear-gradient(180deg,rgba(255,255,255,.9),rgba(255,255,255,.65))}
    .nav{display:flex; align-items:center; justify-content:space-between; padding:14px 0}
    .brand{display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.3px}
    .nav a{padding:10px 12px; border-radius:10px; color:var(--muted)}
    .nav a:hover, .nav a:focus{outline:none; color:var(--text); background:rgba(56,189,248,.08)}
    .actions{display:flex; align-items:center; gap:10px}
    .btn{display:inline-flex; align-items:center; gap:10px; padding:10px 14px; border-radius:12px; border:1px solid rgba(148,163,184,.15); background:var(--panel); box-shadow:var(--shadow); cursor:pointer}
    .btn:hover{filter:brightness(1.05)}
    .btn.primary{background:linear-gradient(135deg,var(--brand),var(--brand-2)); color:#00121f; font-weight:700; border-color:transparent}

    /* Hero/About */
    .hero{padding:36px 0 16px}
    .about{display:grid; grid-template-columns:1fr; gap:16px; background:linear-gradient(180deg,var(--panel),rgba(56,189,248,.06)); border:1px solid rgba(148,163,184,.14); padding:20px; border-radius:var(--radius)}
    .about h1{margin:0 0 10px; font-size:clamp(22px,5vw,32px)}
    .about p{margin:0; color:var(--muted)}

    /* Toolbar */
    .toolbar{display:flex; gap:10px; flex-wrap:wrap; margin:20px 0}
    .search{flex:1 1 300px; padding:12px 14px; border-radius:12px; border:1px solid rgba(148,163,184,.16); background:var(--panel); color:var(--text)}
    .tabs{display:flex; gap:10px; flex-wrap:wrap}
    .tab{padding:8px 12px; border:1px solid rgba(148,163,184,.18); border-radius:12px; background:var(--panel); color:var(--muted); cursor:pointer}
    .tab.active{background:linear-gradient(135deg,var(--brand),var(--brand-2)); color:#00121f; font-weight:700; border-color:transparent}

    /* Grid */
    .grid{display:grid; grid-template-columns:repeat(12,1fr); gap:16px}
    .product{grid-column:span 12; background:var(--panel); border:1px solid rgba(148,163,184,.14); border-radius:16px; overflow:hidden; transition:transform .2s; box-shadow:var(--shadow); cursor:pointer; position:relative}
    .product:hover{transform:translateY(-3px)}
    .thumb{aspect-ratio:16/10; background:#0b1220; display:grid; place-items:center; overflow:hidden}
    .thumb img{width:100%; height:100%; object-fit:cover}
    .body{padding:14px 16px}
    .title{margin:0 0 8px; font-size:18px}
    .price{color:var(--brand); font-weight:700}
    .meta{display:flex; justify-content:space-between; align-items:center; gap:10px; margin-top:8px}
    .links{display:flex; gap:10px}

    @media(min-width:640px){ .product{grid-column:span 6} }
    @media(min-width:980px){ .product{grid-column:span 3} }

    /* Footer */
    footer{padding:40px 0 60px; color:var(--muted); border-top:1px solid rgba(148,163,184,.14); margin-top:30px}
    .pay{display:flex; gap:12px; flex-wrap:wrap; align-items:center; justify-content:center; margin-top:10px}
    .pay span{padding:6px 10px; border-radius:8px; border:1px solid rgba(148,163,184,.18); background:var(--panel)}

    /* Cart Drawer */
    .checkout{position:fixed; right:0; top:0; background:var(--panel); width:min(380px,92vw); height:100%; border-left:1px solid rgba(148,163,184,.18); box-shadow:-10px 0 30px rgba(2,6,23,.4); padding:18px; overflow-y:auto; display:none; z-index:70}
    .checkout h2{margin:0 0 10px}
    .checkout-empty{opacity:.7; text-align:center; padding:10px 0}
    .checkout-item{display:flex; flex-direction:column; border-bottom:1px dashed rgba(148,163,184,.16); padding:10px 0; gap:6px}
    .item-title{font-weight:600}
    .item-controls{display:flex; justify-content:space-between; align-items:center; gap:10px}
    .quantity-btn{background:linear-gradient(135deg,var(--brand),var(--brand-2)); color:#00121f; border:none; border-radius:10px; padding:6px 10px; cursor:pointer}
    .remove-btn{background:#ef4444; color:#fff; border:none; border-radius:10px; padding:6px 10px; cursor:pointer}
    .total{display:flex; justify-content:space-between; margin-top:12px; font-weight:800}
    .clear-cart{background:#f59e0b; color:#00121f; border:none; border-radius:12px; padding:10px 12px; cursor:pointer; width:100%; margin-top:12px}
    .checkout-actions{display:flex; gap:10px; margin-top:10px}

    /* Modal + slider */
    .modal-backdrop{
      position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:80;
      background:var(--overlay);
      backdrop-filter: blur(6px) saturate(1.1);
    }
    .modal-backdrop.show{display:flex;}
    .modal{
      width:min(900px,96vw); background:var(--panel); border-radius:14px; padding:18px;
      display:grid; grid-template-columns:1fr 1fr; gap:16px;
      box-shadow: 0 20px 60px rgba(0,0,0,.45), 0 0 0 1px rgba(148,163,184,.2) inset;
      opacity:0; transform: scale(.95); animation: modalIn .35s ease-out forwards;
      position:relative;
    }
    @media(max-width:900px){ .modal{grid-template-columns:1fr;} }

    .modal .left{display:flex; flex-direction:column; gap:10px}
    .viewer{background:#08101a; border-radius:10px; overflow:hidden; min-height:280px; aspect-ratio:16/9; display:grid; place-items:center; position:relative}
    .viewer img, .viewer iframe{width:100%; height:100%; object-fit:cover; border:0}
    .thumbs{
      display:flex; gap:10px; overflow-x:auto; padding:6px 2px;
      -webkit-overflow-scrolling: touch; scrollbar-width: thin;
      border-top:1px solid rgba(148,163,184,.14)
    }
    .thumbs::-webkit-scrollbar{height:8px}
    .thumbs::-webkit-scrollbar-thumb{background:rgba(148,163,184,.25); border-radius:999px}
    .tbtn{
      flex:0 0 auto; width:80px; height:56px; border-radius:10px; overflow:hidden; border:1px solid rgba(148,163,184,.2);
      opacity:.75; cursor:pointer; position:relative; background:#0b1220;
    }
    .tbtn img{width:100%; height:100%; object-fit:cover}
    .tbtn.active{outline:3px solid rgba(56,189,248,.55); opacity:1}
    .tbtn .play{
      position:absolute; inset:auto auto 6px 6px; font-size:11px; font-weight:800; padding:4px 6px; border-radius:8px;
      background:linear-gradient(135deg,var(--brand),var(--brand-2)); color:#00121f;
    }

    .modal .right{display:flex; flex-direction:column; gap:10px}
    .modal h2{margin:0}
    .modal p{margin:0; color:var(--muted)}
    .modal .price{font-weight:800; color:var(--brand)}
    .modal .actions{display:flex; gap:10px; margin-top:12px}
    .close-x{position:absolute; right:14px; top:12px; background:transparent; border:1px solid rgba(148,163,184,.25); color:var(--muted); cursor:pointer; font-size:18px; border-radius:10px; padding:6px 10px}

    /* Animations */
    @keyframes fadeInBlock {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade { animation: fadeInBlock .8s ease-out forwards; }

    .fade-in { opacity: 0; transform: translateY(30px); transition: all .6s ease-out; }
    .fade-in.visible { opacity: 1; transform: translateY(0); }

    @keyframes modalIn {
      from { opacity:0; transform:scale(.95); }
      to   { opacity:1; transform:scale(1); }
    }
    .modal-content img {
  max-width: 100%;
  max-height: 70vh; /* biar nggak lebih tinggi dari layar HP */
  width: auto;
  height: auto;
  object-fit: contain;
  border-radius: 8px;
}
  .modal {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 10px; /* biar ada ruang di sisi HP */
}

.modal-content {
  max-width: 95%;
  max-height: 90vh;
  overflow: hidden;
}

  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <a class="brand" href="#top"><span>ysurtod</span></a>
      <nav class="menu" aria-label="Menu utama">
        <a href="Porto.html">About</a>
        <a href="Payhip.html">Project</a>
      </nav>
      <div class="actions">
        <button class="btn cart" id="openCart" aria-label="Buka keranjang">ðŸ›’ <span class="cart-count" id="cartCount">0</span></button>
        <div class="nav-right">
          <a href="contoh vidio.html" class="btn primary">Contact Me</a>
        </div>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- Hero / About -->
    <section class="hero">
      <div class="about animate-fade">
        <div>
          <h1>SXM</h1>
          <p>Free Project File.</p>
        </div>
      </div>
    </section>

    <!-- Toolbar: search + kategori -->
    <section class="toolbar" aria-label="Pencarian dan kategori">
      <input class="search" id="search" type="search" placeholder="Cari produk (mis. project file, preset)" aria-label="Cari produk" />
      <div class="tabs" role="tablist">
        <button class="tab active" data-filter="all" role="tab" aria-selected="true">All Products</button>
        <button class="tab" data-filter="project" role="tab">Project File</button>
        <button class="tab" data-filter="preset" role="tab">Preset</button>
        <button class="tab" data-filter="asset" role="tab">Assets</button>
      </div>
    </section>

    <!-- GRID TOKO -->
    <section id="shop" class="grid" role="list">
      <!-- Product cards -->
      <article class="product fade-in"
        data-type="project"
        data-tags="project file happier"
        data-desc="Tes Web ysurtod Sc vidio= Sachezae."
        data-download="https://payhip.com/b/WXhGZ"
        data-video="https://youtu.be/7l3VjQwXqk8?si=5wNAI6g13nwkaLcN"
        data-images='["https://images2.imgbox.com/36/89/gfyOjxrH_o.png","https://wallpapercave.com/wp/wp3923449.jpg"]'
        role="listitem">
        <div class="thumb"><img src="https://images2.imgbox.com/36/89/gfyOjxrH_o.png" alt="Preview produk: Happier project"/></div>
        <div class="body">
          <h3 class="title">Happier Project</h3>
          <div class="meta">
            <span class="price">Free</span>
            <div class="links">
              <a class="btn" href="#" onclick="addToCart('Happier Project',0);return false;">Add</a>
              <a class="btn primary" href="#" onclick="buyNow('Happier Project',0);return false;">Buy</a>
            </div>
          </div>
        </div>
      </article>

      <article class="product fade-in" data-type="project" data-tags="project file best day"
        data-desc="You need this plugin before download (Particular, Element, Optical Flare, Looks, RSMB, Twixtor, Sapphire, BCC)."
        data-download="https://payhip.com/b/PidEj"
        data-video="https://youtu.be/7l3VjQwXqk8?si=5wNAI6g13nwkaLcN"
        data-images='["https://images2.imgbox.com/18/9a/mFIzbnEA_o.png","https://wallpapercave.com/uwp/uwp3828720.jpeg"]'
        role="listitem">
        <div class="thumb"><img src="https://images2.imgbox.com/18/9a/mFIzbnEA_o.png" alt="Preview produk: Best Day"/></div>
        <div class="body">
          <h3 class="title">Best Day</h3>
          <div class="meta">
            <span class="price">Free</span>
            <div class="links">
              <a class="btn" href="#" onclick="addToCart('Best Day',0);return false;">Add</a>
              <a class="btn primary" href="#" onclick="buyNow('Best Day',0);return false;">Buy</a>
            </div>
          </div>
        </div>
      </article>

      <article class="product fade-in" data-type="project" data-tags="ml blending light"
        data-desc="Paket asset ML Blending Light: overlay, textures, dan LUT sederhana."
        data-download="https://payhip.com/b/WXhGZ"
        data-video="https://youtu.be/7l3VjQwXqk8?si=5wNAI6g13nwkaLcN"
        data-images='["https://images2.imgbox.com/44/a3/0UuLuADb_o.png"]'
        role="listitem">
        <div class="thumb"><img src="https://images2.imgbox.com/44/a3/0UuLuADb_o.png" alt="Preview produk: ML Blending Light"/></div>
        <div class="body">
          <h3 class="title">ML Blending Light</h3>
          <div class="meta">
            <span class="price">Free</span>
            <div class="links">
              <a class="btn" href="#" onclick="addToCart('ML Blending Light',0);return false;">Add</a>
              <a class="btn primary" href="#" onclick="buyNow('ML Blending Light',0);return false;">Buy</a>
            </div>
          </div>
        </div>
      </article>

      <article class="product fade-in" data-type="project" data-tags="right now pf"
        data-desc="Preset RIGHT NOW PF: adjustment layers dan color grading."
        data-download="https://payhip.com/b/hgplZ"
        data-video="https://youtu.be/7l3VjQwXqk8?si=5wNAI6g13nwkaLcN"
        data-images='["https://images2.imgbox.com/e1/07/tnnOllLg_o.png"]'
        role="listitem">
        <div class="thumb"><img src="https://images2.imgbox.com/e1/07/tnnOllLg_o.png" alt="Preview produk: RIGHT NOW PF"/></div>
        <div class="body">
          <h3 class="title">RIGHT NOW PF</h3>
          <div class="meta">
            <span class="price">Free</span>
            <div class="links">
              <a class="btn" href="#" onclick="addToCart('RIGHT NOW PF',0);return false;">Add</a>
              <a class="btn primary" href="#" onclick="buyNow('RIGHT NOW PF',0);return false;">Buy</a>
            </div>
          </div>
        </div>
      </article>

      <article class="product fade-in" data-type="project" data-tags="18 project file"
        data-desc="Koleksi 18 project file â€” paket bundel untuk latihan editing."
        data-download="https://payhip.com/b/5d4VN"
        data-video="https://youtu.be/7l3VjQwXqk8?si=5wNAI6g13nwkaLcN"
        data-images='["https://images2.imgbox.com/c6/60/oLxBdkXt_o.png"]'
        role="listitem">
        <div class="thumb"><img src="https://images2.imgbox.com/c6/60/oLxBdkXt_o.png" alt="Preview produk: 18 Project File"/></div>
        <div class="body">
          <h3 class="title">18 Project File</h3>
          <div class="meta">
            <span class="price">Free</span>
            <div class="links">
              <a class="btn" href="#" onclick="addToCart('18 Project File',0);return false;">Add</a>
              <a class="btn primary" href="#" onclick="buyNow('18 Project File',0);return false;">Buy</a>
            </div>
          </div>
        </div>
      </article>

      <article class="product fade-in" data-type="project" data-tags="lady killer happier project"
        data-desc="Lady Killer project: includes transitions and title comps."
        data-download="https://payhip.com/b/lUaDn"
        data-video="https://youtu.be/7l3VjQwXqk8?si=5wNAI6g13nwkaLcN" 
        data-images='["https://images2.imgbox.com/08/e2/uMqHdWXl_o.png"]'
        role="listitem">
        <div class="thumb"><img src="https://images2.imgbox.com/08/e2/uMqHdWXl_o.png" alt="Preview produk: Lady Killer"/></div>
        <div class="body">
          <h3 class="title">Lady Killer</h3>
          <div class="meta">
            <span class="price">Free</span>
            <div class="links">
              <a class="btn" href="#" onclick="addToCart('Lady Killer',0);return false;">Add</a>
              <a class="btn primary" href="#" onclick="buyNow('Lady Killer',0);return false;">Buy</a>
            </div>
          </div>
        </div>
      </article>
    </section>
  </main>

  <!-- Drawer Keranjang -->
  <aside class="checkout" id="checkout" aria-hidden="true" role="dialog" aria-label="Keranjang belanja">
    <h2>Keranjang</h2>
    <div id="checkout-items"></div>
    <div class="total"><span>Total</span> <span>Rp <span id="total-price">0</span></span></div>
    <div class="checkout-actions">
      <button class="btn" onclick="toggleCheckout()">Close</button>
      <button class="btn primary" onclick="checkout()">Checkout</button>
    </div>
    <button class="clear-cart" onclick="clearCart()">Remove All</button>
  </aside>

  <!-- Modal backdrop + modal -->
  <div class="modal-backdrop" id="productModal" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <button class="close-x" id="modalClose" aria-label="Tutup">âœ•</button>
      <div class="left">
        <div class="viewer" id="viewer">
          <img id="viewerImg" src="" alt="" />
          <!-- iframe video akan dibuat/dihapus via JS -->
        </div>
        <div class="thumbs" id="thumbs" aria-label="Thumbnail media"></div>
      </div>
      <div class="right">
        <h2 id="modalTitle">Product Title</h2>
        <div class="price" id="modalPrice">Rp 0</div>
        <p id="modalDesc">Deskripsi produk akan muncul di sini.</p>
        <div class="actions">
          <button class="btn" id="modalAdd">Add</button>
          <button class="btn primary" id="modalBuy">Buy Now</button>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <div class="container" style="text-align:center">
      <div>Â© <span id="year"></span> ysurtod</div>
      <div class="pay">
        <span>Maestro</span><span>Mastercard</span><span>PayPal</span><span>Visa</span><span>Discover</span>
      </div>
    </div>
  </footer>

  <script>
    // Theme toggles

    // Tahun footer
    document.getElementById('year').textContent = new Date().getFullYear();

    // Tabs + Search filter
    const tabs = document.querySelectorAll('.tab');
    const search = document.getElementById('search');
    const cards = [...document.querySelectorAll('.product')];
    let active = 'all';
    function apply(){
      const q = (search.value || '').toLowerCase();
      cards.forEach(c=>{
        const type = c.dataset.type;
        const tags = (c.dataset.tags||'').toLowerCase();
        const title = c.querySelector('.title').textContent.toLowerCase();
        const okType = active==='all' || type===active;
        const okSearch = !q || tags.includes(q) || title.includes(q);
        c.style.display = okType && okSearch ? '' : 'none';
      });
    }
    tabs.forEach(t=>t.addEventListener('click',()=>{
      tabs.forEach(x=>x.classList.remove('active'));
      t.classList.add('active'); active=t.dataset.filter; apply();
    }));
    search.addEventListener('input', apply);

    // ===== CART =====
    let cart = JSON.parse(localStorage.getItem('ys_cart')||'[]');
    function persist(){ localStorage.setItem('ys_cart', JSON.stringify(cart)); }
    function addToCart(product, price){
      const existing = cart.find(item => item.name === product);
      if (existing) { existing.qty++; }
      else { cart.push({ name: product, price: price, qty: 1 }); }
      updateCartDisplay(); openCart();
    }
    function buyNow(product, price){ addToCart(product, price); }
    function removeFromCart(index){ cart.splice(index, 1); updateCartDisplay(); }
    function changeQuantity(index, delta){
      cart[index].qty += delta;
      if (cart[index].qty <= 0) { removeFromCart(index); }
      else { updateCartDisplay(); }
    }
    function clearCart(){ cart = []; updateCartDisplay(); }
    function formatIDR(v){ return v.toLocaleString('id-ID'); }
    function updateCartDisplay(){
      persist();
      const count = cart.reduce((s,it)=> s + it.qty, 0);
      document.getElementById('cartCount').textContent = count;
      const wrap = document.getElementById('checkout-items');
      wrap.innerHTML = '';
      let total = 0;
      if(cart.length===0){
        wrap.innerHTML = '<p class="checkout-empty">Keranjang kosong</p>';
      } else {
        cart.forEach((it,i)=>{
          total += (it.price||0) * it.qty;
          const div = document.createElement('div');
          div.className = 'checkout-item';
          div.innerHTML = `
            <div class="item-title">${it.name}</div>
            <div class="item-controls">
              <div>
                <button class="quantity-btn" onclick="changeQuantity(${i}, -1)">-</button>
                <span style="margin:0 6px">${it.qty}</span>
                <button class="quantity-btn" onclick="changeQuantity(${i}, 1)">+</button>
              </div>
              <div>
                <span>${it.price?('Rp '+formatIDR(it.price)):'Free'}</span>
                <button class="remove-btn" onclick="removeFromCart(${i})">Hapus</button>
              </div>
            </div>`;
          wrap.appendChild(div);
        });
      }
      document.getElementById('total-price').textContent = formatIDR(total);
    }
    function openCart(){
      const el = document.getElementById('checkout');
      el.style.display='block';
      el.setAttribute('aria-hidden','false');
    }
    function toggleCheckout(){
      const el = document.getElementById('checkout');
      const shown = getComputedStyle(el).display !== 'none';
      el.style.display = shown ? 'none' : 'block';
      el.setAttribute('aria-hidden', shown ? 'true' : 'false');
    }
    function checkout(){
      if(cart.length===0){ alert('Keranjang kosong'); return; }
      cart.forEach(item=>{
        const el = [...document.querySelectorAll('.product')].find(p=>p.querySelector('.title').textContent===item.name);
        if(el){
          const dl = el.dataset.download;
          if(dl) window.open(dl, '_blank');
        }
      });
    }
    document.getElementById('openCart').addEventListener('click', openCart);

    // A11y focus ring
    document.querySelectorAll('a,button,input').forEach(el=>{
      el.addEventListener('focus',()=>{ el.style.boxShadow = '0 0 0 4px rgba(56,189,248,.35)'; });
      el.addEventListener('blur',()=>{ el.style.boxShadow = 'none'; });
    });

    // ====== MODAL + SLIDER (Video + Images) ======
    const modalBackdrop = document.getElementById('productModal');
    const viewer = document.getElementById('viewer');
    const viewerImg = document.getElementById('viewerImg');
    const modalTitle = document.getElementById('modalTitle');
    const modalPrice = document.getElementById('modalPrice');
    const modalDesc = document.getElementById('modalDesc');
    const modalAdd = document.getElementById('modalAdd');
    const modalBuy = document.getElementById('modalBuy');
    const modalclose = document.getElementById('modalClose');
    const thumbsWrap = document.getElementById('thumbs');

    let media = [];         // [{type:'video'|'image', url:'...', thumb:'...'}]
    let currentIndex = 0;
    let currentProduct = null; // {name, price, download}
    let activeIframe = null;

    function lockScroll(lock){ document.body.style.overflow = lock ? 'hidden' : ''; }

    function parseYouTubeId(url){
      if(!url) return null;
      try{
        const u = new URL(url);
        if (u.hostname.includes('youtu.be')) return u.pathname.slice(1);
        if (u.hostname.includes('youtube.com')){
          if (u.pathname.startsWith('/watch')) return u.searchParams.get('v');
          if (u.pathname.startsWith('/shorts/')) return u.pathname.split('/')[2];
          if (u.pathname.startsWith('/embed/')) return u.pathname.split('/')[2];
        }
        return null;
      }catch(e){ return null; }
    }
    function buildEmbedUrl(fullUrl){
      const id = parseYouTubeId(fullUrl);
      if(!id) return null;
      const params = new URLSearchParams({
        autoplay: '1', mute: '1', controls: '1', rel: '0',
        playsinline: '1', modestbranding: '1', enablejsapi: '1'
      });
      return `https://www.youtube.com/embed/${id}?${params.toString()}`;
    }
    function ytThumb(fullUrl){
      const id = parseYouTubeId(fullUrl);
      return id ? `https://img.youtube.com/vi/${id}/hqdefault.jpg` : '';
    }

    function stopVideo(){
      if(activeIframe){
        try{
          activeIframe.contentWindow.postMessage(JSON.stringify({
            event:"command", func:"stopVideo", args:""
          }), "*");
        }catch(e){}
        // Remove iframe to fully stop on close
        activeIframe.remove();
        activeIframe = null;
      }
    }

    function showMedia(index){
      // if leaving a video, stop it
      if(media[currentIndex] && media[currentIndex].type==='video') stopVideo();

      currentIndex = index;

      const item = media[currentIndex];
      // reset viewer
      viewerImg.style.display = 'none';
      // remove leftover iframe if any
      const oldIframe = viewer.querySelector('iframe');
      if(oldIframe) oldIframe.remove();

      if(item.type==='image'){
        viewerImg.src = item.url;
        viewerImg.alt = modalTitle.textContent || 'Preview';
        viewerImg.style.display = 'block';
      } else {
        // create iframe with autoplay mute
        const iframe = document.createElement('iframe');
        iframe.allow = "autoplay; encrypted-media; picture-in-picture";
        iframe.src = buildEmbedUrl(item.url);
        iframe.style.width = "100%";
        iframe.style.height = "100%";
        iframe.style.border = "0";
        viewer.appendChild(iframe);
        activeIframe = iframe;
     }

      // update active thumb
      [...thumbsWrap.children].forEach((el,i)=> el.classList.toggle('active', i===currentIndex));
      // auto scroll active thumb into view
      const activeThumb = thumbsWrap.children[currentIndex];
      if(activeThumb) activeThumb.scrollIntoView({ inline:'center', block:'nearest', behavior:'smooth' });
    }

    function renderThumbs(){
      thumbsWrap.innerHTML = '';
      media.forEach((m,i)=>{
        const b = document.createElement('button');
        b.className = 'tbtn'+(i===currentIndex?' active':'');
        b.type = 'button';
        const img = document.createElement('img');
        img.src = m.thumb || m.url;
        img.alt = m.type==='video' ? 'Video' : 'Gambar '+(i+1);
        b.appendChild(img);
        if(m.type==='video'){
          const tag = document.createElement('span');
          tag.className = 'play';
          tag.textContent = 'â–¶ Video';
          b.appendChild(tag);
        }
        b.addEventListener('click', ()=> showMedia(i));
        thumbsWrap.appendChild(b);
      });
    }

    function openProductModal(productEl){
      const images = JSON.parse(productEl.dataset.images || '[]');
      const desc = productEl.dataset.desc || '';
      const download = productEl.dataset.download || '';
      const videoURL = productEl.dataset.video || '';
      const name = productEl.querySelector('.title').textContent;
      const priceText = productEl.querySelector('.price').textContent;

      // Build media list: video first (if any), then images
      media = [];
      if(videoURL){
        const embed = buildEmbedUrl(videoURL);
        if(embed) media.push({ type:'video', url: embed, thumb: ytThumb(videoURL) });
      }
      const fallbackThumb = productEl.querySelector('.thumb img')?.src;
      const imgList = images.length ? images : (fallbackThumb ? [fallbackThumb] : []);
      media.push(...imgList.map(u => ({ type:'image', url:u, thumb:u })));

      currentIndex = 0;
      currentProduct = {
        name,
        priceText,
        download,
        price: parseInt((priceText || '').replace(/[^0-9]/g,'')) || 0
      };

      modalTitle.textContent = name;
      modalPrice.textContent = priceText;
      modalDesc.textContent = desc;

      modalAdd.onclick = ()=>{ addToCart(currentProduct.name, currentProduct.price); };
      modalBuy.onclick = ()=>{ if(currentProduct.download) window.open(currentProduct.download,'_blank'); else alert('Tidak ada link download.'); };

      renderThumbs();
      showMedia(0);

      modalBackdrop.classList.add('show');
      modalBackdrop.setAttribute('aria-hidden','false');
      lockScroll(true);
      modalClose.focus();
    }

    function closeProductModal(){
      stopVideo();
      modalBackdrop.classList.remove('show');
      modalBackdrop.setAttribute('aria-hidden','true');
      lockScroll(false);
    }

    // Swipe gesture (mobile)
    (function attachSwipe(){
      let sx=0, sy=0, dx=0, dy=0, touching=false;
      viewer.addEventListener('touchstart', (e)=>{ touching=true; sx=e.touches[0].clientX; sy=e.touches[0].clientY; dx=0; dy=0; }, {passive:true});
      viewer.addEventListener('touchmove', (e)=>{ if(!touching) return; dx=e.touches[0].clientX - sx; dy=e.touches[0].clientY - sy; }, {passive:true});
      viewer.addEventListener('touchend', ()=>{
        if(!touching) return;
        touching=false;
        if(Math.abs(dx) > 40 && Math.abs(dx) > Math.abs(dy)){
          const next = dx < 0;
          const ni = (currentIndex + (next?1:-1) + media.length) % media.length;
          showMedia(ni);
        }
      });
    })();

    // Keyboard: ESC close, arrows navigate
    document.addEventListener('keydown', (e)=>{
      const shown = modalBackdrop.classList.contains('show');
      if(!shown) return;
      if(e.key === 'Escape') closeProductModal();
      if(e.key === 'ArrowLeft'){
        const ni = (currentIndex - 1 + media.length) % media.length;
        showMedia(ni);
      }
      if(e.key === 'ArrowRight'){
        const ni = (currentIndex + 1) % media.length;
        showMedia(ni);
      }
    });

    const modalClose = document.getElementById('modalClose');
    modalClose.addEventListener('click', closeProductModal);
    modalBackdrop.addEventListener('click', (e)=>{ if(e.target===modalBackdrop) closeProductModal(); });

    // Open modal saat klik card (kecuali klik pada tombol di dalamnya)
    document.querySelectorAll('.product').forEach(p=>{
      p.addEventListener('click', (e)=>{
        if(e.target.closest('.links')) return; // biar tombol Add/Buy tetap berfungsi normal
        openProductModal(p);
      });
    });

    cards.forEach(card=>{
  card.addEventListener('click', (e)=>{
    if(e.target.closest('.btn')) return; // supaya klik tombol Add/Buy nggak buka modal
    openModal(card);
  });
});

function openModal(card){
  currentProduct = {
    name: card.querySelector('.title').textContent,
    price: 0,
    download: card.dataset.download
  };
  modalTitle.textContent = currentProduct.name;
  modalPrice.textContent = currentProduct.price ? 'Rp '+formatIDR(currentProduct.price) : 'Free';
  modalDesc.textContent = card.dataset.desc || '';
  modalAdd.onclick = ()=>addToCart(currentProduct.name,currentProduct.price);
  modalBuy.onclick = ()=>buyNow(currentProduct.name,currentProduct.price);

  // Bangun media array
  media = [];
  if(card.dataset.video) media.push({type:'video',url:card.dataset.video,thumb:ytThumb(card.dataset.video)});
  try{
    const imgs = JSON.parse(card.dataset.images||'[]');
    imgs.forEach(u=>media.push({type:'image',url:u}));
  }catch(e){}
  
  // Thumbnails
  thumbsWrap.innerHTML='';
  media.forEach((m,i)=>{
    const t = document.createElement('div');
    t.className='tbtn'+(i===0?' active':'');
    if(m.type==='video'){
      t.innerHTML=`<img src="${m.thumb}"><div class="play">â–¶</div>`;
    }else{
      t.innerHTML=`<img src="${m.url}">`;
    }
    t.onclick=()=>{document.querySelectorAll('.tbtn').forEach(x=>x.classList.remove('active'));t.classList.add('active');showMedia(i);};
    thumbsWrap.appendChild(t);
  });

  modalBackdrop.classList.add('show');
  lockScroll(true);
  showMedia(0);
}

modalclose.addEventListener('click',()=>{ stopVideo(); modalBackdrop.classList.remove('show'); lockScroll(false); });
modalBackdrop.addEventListener('click',(e)=>{ if(e.target===modalBackdrop){ stopVideo(); modalBackdrop.classList.remove('show'); lockScroll(false); }});


    // Init
    updateCartDisplay();
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => { if (entry.isIntersecting) entry.target.classList.add('visible'); });
    }, { threshold: .15 });
    document.querySelectorAll('.fade-in').forEach(el => observer.observe(el));
  </script>
</body>
</html>

